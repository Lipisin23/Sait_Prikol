<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è ESP8266</title>
  <style>
    :root {
      --outdoor-color: #4285F4;
      --indoor-color: #EA4335;
      --weather-color: #FBBC05;
      --card-bg: #ffffff;
      --text-dark: #333333;
      --text-light: #666666;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      margin: 0;
      padding: 15px;
      background: #f5f7fa;
      color: var(--text-dark);
    }
    
    .dashboard {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .sensor-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      font-weight: 600;
    }
    
    .outdoor-header { color: var(--outdoor-color); }
    .indoor-header { color: var(--indoor-color); }
    .weather-header { color: var(--weather-color); }
    
    .card-icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 10px;
    }
    
    .outdoor-icon { background: var(--outdoor-color); }
    .indoor-icon { background: var(--indoor-color); }
    .weather-icon { background: var(--weather-color); }
    
    .sensor-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .sensor-row:last-child {
      border-bottom: none;
    }
    
    .sensor-label {
      color: var(--text-light);
    }
    
    .sensor-value {
      font-weight: 500;
    }
    
    .temp-value { color: #e53935; }
    .hum-value { color: #1e88e5; }
    .pres-value { color: #43a047; }
    .wind-value { color: #7b1fa2; }
    .weather-value { color: var(--weather-color); }
    
    .weather-icon-large {
      font-size: 48px;
      text-align: center;
      margin: 15px 0;
    }
    
    .update-time {
      font-size: 12px;
      color: var(--text-light);
      text-align: right;
      margin-top: 10px;
      font-style: italic;
    }
    
    @media (max-width: 480px) {
      .sensor-card {
        padding: 15px;
      }
      
      .sensor-row {
        padding: 10px 0;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <!-- –°–µ–∫—Ü–∏—è –ø–æ–≥–æ–¥—ã -->
    <div class="sensor-card">
      <div class="card-header weather-header">
        <div class="card-icon weather-icon"></div>
        <span>–ü–æ–≥–æ–¥–∞ —Å–µ–π—á–∞—Å</span>
      </div>
      
      <div class="weather-icon-large" id="weather-icon">‚òÄÔ∏è</div>
      
      <div class="sensor-row">
        <span class="sensor-label">–°–æ—Å—Ç–æ—è–Ω–∏–µ</span>
        <span id="weather-text" class="sensor-value weather-value">--</span>
      </div>
      
      <div id="weather-time" class="update-time"></div>
    </div>
    
    <!-- –£–ª–∏—á–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ -->
    <div class="sensor-card">
      <div class="card-header outdoor-header">
        <div class="card-icon outdoor-icon"></div>
        <span>–£–ª–∏—á–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
        <span id="out-temp" class="sensor-value temp-value">--</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
        <span id="out-hum" class="sensor-value hum-value">--</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–î–∞–≤–ª–µ–Ω–∏–µ</span>
        <span id="out-pres" class="sensor-value pres-value">-- hPa</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞</span>
        <span id="out-wind" class="sensor-value wind-value">-- –º/—Å</span>
      </div>
      
      <div id="out-time" class="update-time"></div>
    </div>
    
    <!-- –ö–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ -->
    <div class="sensor-card">
      <div class="card-header indoor-header">
        <div class="card-icon indoor-icon"></div>
        <span>–ö–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
        <span id="in-temp" class="sensor-value temp-value">--</span>
      </div>
      
      <div class="sensor-row">
        <span class="sensor-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
        <span id="in-hum" class="sensor-value hum-value">--</span>
      </div>
      
      <div id="in-time" class="update-time"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCzX29wtGTvSM5slyqqdGtpcbeZUzUjfrU",
  authDomain: "weather-station-dce51.firebaseapp.com",
  databaseURL: "https://weather-station-dce51-default-rtdb.firebaseio.com",
  projectId: "weather-station-dce51",
  storageBucket: "weather-station-dce51.firebasestorage.app",
  messagingSenderId: "853096112287",
  appId: "1:853096112287:web:fb5e84c9ff5f9f24cf02aa",
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏ –∏–∫–æ–Ω–æ–∫
    const WEATHER_ICONS = {
      '—Å–æ–ª–Ω–µ—á–Ω–æ': '‚òÄÔ∏è',
      '–æ–±–ª–∞—á–Ω–æ': '‚òÅÔ∏è',
      '–¥–æ–∂–¥—å': 'üåßÔ∏è',
      '–≥—Ä–æ–∑–∞': '‚õàÔ∏è',
      '—Å–Ω–µ–≥': '‚ùÑÔ∏è',
      '—Ç—É–º–∞–Ω': 'üå´Ô∏è',
      '–≤–µ—Ç—Ä–µ–Ω–æ': 'üå¨Ô∏è'
    };

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    function initRealTimeUpdates() {
      database.ref('/').on('value', (snapshot) => {
        const data = snapshot.val();
        updateDisplay(data);
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateDisplay(data) {
      console.log("New data:", data);
      
      // –£–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (data.outdoor) {
        updateValue('out-temp', data.outdoor.temp, '¬∞C');
        updateValue('out-hum', data.outdoor.hum, '%');
        updateValue('out-pres', data.outdoor.pres, 'hPa');
        updateValue('out-wind', data.outdoor.wind, '–º/—Å');
      }
      
      // –ö–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (data.indoor) {
        updateValue('in-temp', data.indoor.temp, '¬∞C');
        updateValue('in-hum', data.indoor.hum, '%');
      }
      
      // –ü–æ–≥–æ–¥–∞
      if (data.weather) {
        const weatherText = data.weather.text || "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
        document.getElementById('weather-text').textContent = weatherText;
        document.getElementById('weather-icon').textContent = 
          WEATHER_ICONS[weatherText.toLowerCase()] || '‚ùì';
      }
      
      // –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      if (data.last_updated) {
        const date = new Date(data.last_updated * 1000);
        const timeString = date.toLocaleTimeString('ru-RU');
        document.querySelectorAll('.update-time').forEach(el => {
          el.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${timeString}`;
        });
      }
    }
    
    function updateValue(elementId, value, unit) {
      const element = document.getElementById(elementId);
      if (element && value !== null && value !== undefined) {
        element.textContent = value.toFixed(1) + (unit || '');
      }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    initRealTimeUpdates();
  </script>
</body>
</html>
